<div class="liga-name mat-headline-1">{{ ligaName }}</div>
<mat-tab-group>
  <mat-tab label="Spiele">
    <mat-form-field>
      <mat-label>Suche</mat-label>
      <input matInput (keyup)="applyGamesFilter($event)">
    </mat-form-field>
    <div class="table-container">
      <table mat-table [dataSource]="dataSourceGames" class="mat-elevation-z8">

        <ng-container matColumnDef="start">
          <th mat-header-cell *matHeaderCellDef> Start</th>
          <td mat-cell *matCellDef="let element"> {{ element.start }}</td>
        </ng-container>

        <ng-container matColumnDef="homeImage">
          <th mat-header-cell *matHeaderCellDef></th>
          <td mat-cell *matCellDef="let element">
            <img *ngIf="element.homeImageUrl" [src]="element.homeImageUrl" alt="{{ element.home }}" class="team-logo">
          </td>
        </ng-container>

        <ng-container matColumnDef="home">
          <th mat-header-cell *matHeaderCellDef> Heim</th>
          <td mat-cell *matCellDef="let element"> {{ element.home }}</td>
        </ng-container>

        <ng-container matColumnDef="guest">
          <th mat-header-cell *matHeaderCellDef> Gast</th>
          <td mat-cell *matCellDef="let element"> {{ element.guest }}</td>
        </ng-container>

        <ng-container matColumnDef="guestImage">
          <th mat-header-cell *matHeaderCellDef></th>
          <td mat-cell *matCellDef="let element">
            <img *ngIf="element.guestImageUrl" [src]="element.guestImageUrl" alt="{{ element.guest }}" class="team-logo">
          </td>
        </ng-container>

        <ng-container matColumnDef="location">
          <th mat-header-cell *matHeaderCellDef> Ort</th>
          <td mat-cell class="location-link" (click)="navigateToMapsLink(element, $event)"
              *matCellDef="let element">{{ element.location }}
          </td>
        </ng-container>

        <ng-container matColumnDef="result">
          <th mat-header-cell *matHeaderCellDef> Ergebnis</th>
          <td mat-cell *matCellDef="let element"> {{ element.result }}</td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumnsGames"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumnsGames;"
            [class.past-events]="checkEventInPast(row.start)"></tr>
      </table>
    </div>
  </mat-tab>
  <mat-tab *ngIf="dataSourceTable.data.length > 0" label="Tabelle">
    <section class="mat-elevation-z8">
      <table mat-table [dataSource]="dataSourceTable" multiTemplateDataRows>

        <ng-container matColumnDef="place">
          <th mat-header-cell *matHeaderCellDef> Platz</th>
          <td mat-cell *matCellDef="let element"> {{ element.place }}</td>
        </ng-container>

        <ng-container matColumnDef="image">
          <th mat-header-cell *matHeaderCellDef></th>
          <td mat-cell *matCellDef="let element">
            <img *ngIf="element.imageUrl" [src]="element.imageUrl" alt="{{ element.team }}" class="team-logo">
          </td>
        </ng-container>

        <ng-container matColumnDef="team">
          <th mat-header-cell *matHeaderCellDef> Team</th>
          <td mat-cell *matCellDef="let element"> {{ element.team }}</td>
        </ng-container>

        <ng-container matColumnDef="games">
          <th mat-header-cell *matHeaderCellDef> Spiele</th>
          <td mat-cell *matCellDef="let element"> {{ element.games }}</td>
        </ng-container>

        <ng-container matColumnDef="wins">
          <th mat-header-cell *matHeaderCellDef> S</th>
          <td mat-cell *matCellDef="let element">{{ element.wins }}</td>
        </ng-container>

        <ng-container matColumnDef="draws">
          <th mat-header-cell *matHeaderCellDef> U</th>
          <td mat-cell *matCellDef="let element"> {{ element.draws }}</td>
        </ng-container>

        <ng-container matColumnDef="losses">
          <th mat-header-cell *matHeaderCellDef> N</th>
          <td mat-cell *matCellDef="let element"> {{ element.losses }}</td>
        </ng-container>

        <ng-container matColumnDef="goals">
          <th mat-header-cell *matHeaderCellDef> T</th>
          <td mat-cell *matCellDef="let element"> {{ element.goals }}</td>
        </ng-container>

        <ng-container matColumnDef="goalDifference">
          <th mat-header-cell *matHeaderCellDef> TD</th>
          <td mat-cell *matCellDef="let element"> {{ element.goalDifference }}</td>
        </ng-container>

        <ng-container matColumnDef="points">
          <th mat-header-cell *matHeaderCellDef> P</th>
          <td mat-cell *matCellDef="let element"> {{ element.points }}</td>
        </ng-container>

        <ng-container matColumnDef="expandedDetail">
          <td mat-cell *matCellDef="let element" [attr.colspan]="displayedColumnsTable.length">
            <div class="example-element-detail"
                 [@detailExpand]="element == expandedElement ? 'expanded' : 'collapsed'">

              <!-- Team Header mit Logo -->
              <div class="team-header">
                <img *ngIf="element.imageUrl" [src]="element.imageUrl" alt="{{ element.team }}" class="team-logo-large">
                <div class="team-info">
                  <h2>{{ element.team }}</h2>
                  <p *ngIf="element.info" class="team-subtitle">{{ element.info }}</p>
                </div>
              </div>

              <!-- Bisherige Spiele -->
              <div *ngIf="expandedGames.length > 0" class="games-section">
                <h3>Bisherige Spiele ({{ expandedGames.length }})</h3>
                <div class="games-list">
                  @for (expandedGame of expandedGames; track expandedGame.start) {
                    <div class="game-card" [class.game-won]="isGameWon(expandedGame, element.team)"
                         [class.game-lost]="isGameLost(expandedGame, element.team)"
                         [class.game-draw]="isGameDraw(expandedGame)">
                      <div class="game-teams">
                        <div class="game-team">
                          <img *ngIf="expandedGame.homeImageUrl" [src]="expandedGame.homeImageUrl"
                               alt="{{ expandedGame.home }}" class="team-logo-small">
                          <span [class.bold-team]="expandedGame.home === element.team">{{ expandedGame.home }}</span>
                        </div>
                        <div class="game-result">{{ expandedGame.result }}</div>
                        <div class="game-team">
                          <span [class.bold-team]="expandedGame.guest === element.team">{{ expandedGame.guest }}</span>
                          <img *ngIf="expandedGame.guestImageUrl" [src]="expandedGame.guestImageUrl"
                               alt="{{ expandedGame.guest }}" class="team-logo-small">
                        </div>
                      </div>
                      <div class="game-info">
                        <span class="game-date">{{ expandedGame.start }}</span>
                        <span class="game-location" *ngIf="expandedGame.location">üìç {{ expandedGame.location }}</span>
                      </div>
                    </div>
                  }
                </div>
              </div>

              <div *ngIf="expandedGames.length === 0" class="no-games">
                <p>Noch keine Spiele gespielt</p>
              </div>

            </div>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumnsTable"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumnsTable;"
            class="example-element-row"
            [class.example-expanded-row]="expandedElement === row"
            (click)="expandedElement = expandedElement === row ? null : row; getGamesByRow(row)"></tr>
        <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="example-detail-row"></tr>
      </table>
    </section>
  </mat-tab>
  <mat-tab label="Torsch√ºtzen">
    <mat-form-field>
      <mat-label>Suche</mat-label>
      <input matInput (keyup)="applyScorerFilter($event)">
    </mat-form-field>
    <div class="table-container">
      <table mat-table [dataSource]="dataSourceScorer" class="mat-elevation-z8">

        <ng-container matColumnDef="place">
          <th mat-header-cell *matHeaderCellDef> Platz</th>
          <td mat-cell *matCellDef="let element"> {{ element.place }}</td>
        </ng-container>

        <ng-container matColumnDef="player">
          <th mat-header-cell *matHeaderCellDef> Spieler</th>
          <td mat-cell *matCellDef="let element"> {{ element.name }}</td>
        </ng-container>

        <ng-container matColumnDef="team">
          <th mat-header-cell *matHeaderCellDef> Team</th>
          <td mat-cell *matCellDef="let element"> {{ element.team }}</td>
        </ng-container>

        <ng-container matColumnDef="goals">
          <th mat-header-cell *matHeaderCellDef> Tore</th>
          <td mat-cell *matCellDef="let element">{{ element.goals }}</td>
        </ng-container>

        <ng-container matColumnDef="games">
          <th mat-header-cell *matHeaderCellDef> Spiele</th>
          <td mat-cell *matCellDef="let element"> {{ element.games }}</td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumnsScorer"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumnsScorer;"></tr>
      </table>
    </div>
  </mat-tab>
</mat-tab-group>

<div *ngIf="isLoading" class="spinner-container">
  <mat-spinner></mat-spinner>
</div>

